!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.TLTInfiniteGallery=t()}}(function(){return function t(e,o,n){function i(r,h){if(!o[r]){if(!e[r]){var a="function"==typeof require&&require;if(!h&&a)return a(r,!0);if(s)return s(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var l=o[r]={exports:{}};e[r][0].call(l.exports,function(t){var o=e[r][1][t];return i(o?o:t)},l,l.exports,t,e,o,n)}return o[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({1:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o["default"]=function(){function t(t,e,n,i,s){this.outercontainer=t,this.imageProvider=e,this.fetchAhead=n,this.columnWidth=i,this.minImageWidthHeightToDisplayIt=s,this.state=new o(this),this.container=$("<div/>",{style:"overflow: scroll; position: fixed"}),this.setContainerDims(),this.container.appendTo(t),this.reset(),$(window).resize(function(t){return function(){t.resized.call(t)}}(this)),this.container.scroll(function(t){return function(){t.scrolled.call(t)}}(this)),e.setResultsChangedObserver(this)}function e(t,e,o,n,i,s){this.owner=t,this.column=e,this.ppIndex=o,this.containerTop=n,this.realWidth=i,this.realHeight=s,this.containerBottom=this.containerTop+this.containerHeight(),this.img=null}function o(t,e){this.owner=t,this.test="boolean"==typeof e?e:!1}var n=10,i=t.prototype;i.reset=function(){if(this.initialized){for(var t=0;t<this.noColumns;t++)this.state.prevOTBDTopIndex[t]=this.state.OTBDTopIndex[t],this.state.prevOTBDBottomIndex[t]=this.state.OTBDBottomIndex[t],this.state.OTBDTopIndex[t]=-1,this.state.OTBDBottomIndex[t]=-2;this.displayOnlyThoseThatOughtToBeDisplayed()}var e=this.calculateContainerWidthAndNoColumns();this.containerWidth=e.containerWidth,this.noColumns=e.noColumns,this.state.reset(),this.initialized=!0,this.state.updateOughtToBeDisplayedTopBottomIndices(),this.addItemsToBottomIfNecessary()},i.calculateContainerWidthAndNoColumns=function(){var t={containerWidth:this.container.width(),noColumns:Math.floor(this.container.width()/this.columnWidth)};return 0==t.noColumns&&(t.noColumns=1),t},i.changed=function(){this.reset()},i.setContainerDims=function(){this.container.css("left",""+this.outercontainer.offset().left+"px"),this.container.css("top",""+this.outercontainer.offset().top+"px"),this.container.css("width",""+this.outercontainer.width()+"px"),this.container.css("height",""+this.outercontainer.height()+"px")},i.resized=function(){this.setContainerDims();var t=this.calculateContainerWidthAndNoColumns();t.noColumns!=this.noColumns&&(console.log("Resetting due to number of columns possible changed from "+this.noColumns+" to "+t.noColumns),this.reset())},i.scrolled=function(){this.state.updateOughtToBeDisplayedTopBottomIndices(),this.displayOnlyThoseThatOughtToBeDisplayed(),this.addItemsToBottomIfNecessary()},i.displayOnlyThoseThatOughtToBeDisplayed=function(){for(var t,e=0;e<this.noColumns;e++){for(var o=this.state.prevOTBDTopIndex[e];o<=this.state.prevOTBDBottomIndex[e];o++)o<this.state.columnItems[e].length&&(o<this.state.OTBDTopIndex[e]||o>this.state.OTBDBottomIndex[e])&&(t=this.state.columnItems[e][o],t.undisplay());for(var n=this.state.OTBDTopIndex[e];n<=this.state.OTBDBottomIndex[e];n++)if(n<this.state.columnItems[e].length&&(t=this.state.columnItems[e][n],!t.displayed())){var i=new Image;i.src=this.imageProvider.url(t.ppIndex),this.setImageDims(i,t),t.display(i)}}},i.addItemsToBottomIfNecessary=function(){var t=this;this.container.queue(function(e){t._addItemsToBottomIfNecessary(),e()})},i._addItemsToBottomIfNecessary=function(){var t=this;if(this.state.missingItemsInBottom()){for(var o=this.state.nextUnaddedPPIndex,i=Math.min(n,this.imageProvider.size()-o),s=o+i,r=o;s>r;r++){var h=r==s-1,a=new Image;a.onload=function(o,n){return function(){t.container.queue(function(i){return function(s){if(i.width>=t.minImageWidthHeightToDisplayIt||i.height>=t.minImageWidthHeightToDisplayIt){var r=t.state.getLowestColumn(),h=t.state.containerTopForNextAddedItem(r),a=new e(t,r,o,h,i.width,i.height);t.setImageDims(i,a),t.state.addItemToBottom(r,a)&&a.display(i)}t.state.removeLoadingImage(i),s(),n&&t.addItemsToBottomIfNecessary()}}(this))}}(r,h),a.onerror=a.onabort=function(){t.state.removeLoadingImage(this),h&&t.addItemsToBottomIfNecessary()};var d=this.imageProvider.url(r);a.src=d,this.state.addLoadingImage(a)}this.state.nextUnaddedPPIndex+=i}},i.setImageDims=function(t,e){t.style.width=""+this.columnWidth+"px",t.style.height=""+e.containerHeight()+"px",t.style.position="absolute",t.style.left=""+e.column*this.columnWidth+"px",t.style.top=""+e.containerTop+"px"};var s=e.prototype;s.containerHeight=function(){return Math.ceil(this.realHeight*this.owner.columnWidth/this.realWidth)},s.displayed=function(){return null!=this.img},s.display=function(t){this.displayed()||(this.img=t,this.owner.container.append(t))},s.undisplay=function(){this.displayed()&&(this.img.remove(),this.img=null)},i.Item=e;var r=o.prototype;return r.reset=function(){this.nextUnaddedPPIndex=0,this.columnItems=[],this.OTBDTopIndex=[],this.OTBDBottomIndex=[],this.prevOTBDTopIndex=[],this.prevOTBDBottomIndex=[];for(var t=0;t<this.owner.noColumns;t++)this.columnItems.push([]),this.OTBDTopIndex.push(-1),this.OTBDBottomIndex.push(-2),this.prevOTBDTopIndex.push(-1),this.prevOTBDBottomIndex.push(-2);this.loadingImages=[]},r.addLoadingImage=function(t){this.loadingImages.push(t)},r.removeLoadingImage=function(t){var e=this.loadingImages.indexOf(t);e>=0&&this.loadingImages.splice(e,1)},r.updateOughtToBeDisplayedTopBottomIndices=function(){for(var t=0;t<this.owner.noColumns;t++)this.updateOughtToBeDisplayedTopBottomIndicesColumn(t)},r.updateOughtToBeDisplayedTopBottomIndicesColumn=function(t){this.prevOTBDTopIndex[t]=this.OTBDTopIndex[t],this.prevOTBDBottomIndex[t]=this.OTBDBottomIndex[t];var e=this.columnItems[t];if(0==e.length)return this.OTBDTopIndex[t]=-1,void(this.OTBDBottomIndex[t]=-2);var o=this.oughtToBeDisplayedPixelTop();if(o>=0&&e[e.length-1].containerBottom<=o)return this.OTBDTopIndex[t]=e.length,void(this.OTBDBottomIndex[t]=e.length);var n,i;-1==this.OTBDTopIndex[t]?(n=0,i=Math.floor((e.length-1)/2)):(n=5,i=Math.min(this.OTBDTopIndex[t],e.length-1)),this.OTBDTopIndex[t]=this.findOughtToBeDisplayedBorderIndexColumn(e,o,i,n,0);var s=this.oughtToBeDisplayedPixelBottom();return s>=0&&e[e.length-1].containerBottom<=s?void(this.OTBDBottomIndex[t]=e.length):(n=5,i=Math.min(Math.ceil(this.OTBDTopIndex[t]+(s-o)/(e[e.length-1].containerBottom/e.length)),e.length-1),void(this.OTBDBottomIndex[t]=this.findOughtToBeDisplayedBorderIndexColumn(e,s,i,n,this.OTBDTopIndex[t])))},r.findOughtToBeDisplayedBorderIndexColumn=function(t,e,o,n,i){var s=o,r=n;if(e>=0){var h,a,d=i,l=t.length-1,u=0;do{if(this.test&&u++>100)throw Error("Too many loops");if(d==l){s=d;break}if(h=t[s].containerBottom>e,a=t[s].containerTop<=e,h){if(!a){if(l=s-1,d==l){s=d;break}var m=Math.ceil((l-d)/2);r>0&&m>r?(s-=r,r=2*r):(s-=m,r=0)}}else{if(d=s+1,d==l){s=d;break}var m=Math.ceil((l-d)/2);r>0&&m>r?(s+=r,r=2*r):(s+=m,r=0)}}while(!h||!a)}return s},r.oughtToBeDisplayedPixelTop=function(){return this.owner.container.scrollTop()-this.owner.fetchAhead},r.oughtToBeDisplayedPixelBottom=function(){return this.owner.container.scrollTop()+this.owner.container.height()+this.owner.fetchAhead},r.missingItemsInBottom=function(){for(var t=0;t<this.owner.noColumns;t++){var e=this.columnItems[t],o=this.OTBDBottomIndex[t];if(0>o||o>=e.length)return!0}return!1},r.getLowestColumn=function(){for(var t=0,e=1;e<this.owner.noColumns;e++)this.containerTopForNextAddedItem(e)<this.containerTopForNextAddedItem(t)&&(t=e);return t},r.containerTopForNextAddedItem=function(t){return 0==this.columnItems[t].length?0:this.columnItems[t][this.columnItems[t].length-1].containerBottom},r.addItemToBottom=function(t,e){var o=this.columnItems[t];o.push(e);var n=this.oughtToBeDisplayedPixelBottom(),i=e.containerTop<=n;if(i){var s=e.containerBottom>n;this.OTBDBottomIndex[t]=o.length-(s?1:0)}return 1==o.length&&(this.OTBDTopIndex[t]=0),i},i.State=o,t}(),e.exports=o["default"]},{}]},{},[1])(1)});
